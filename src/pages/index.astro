---
import Layout from "@/layouts/Layout.astro";
import "@/styles/globals.css";

import Spotlight from "@/components/client/spotlight";
import About from "@/components/client/about.tsx";
import Avatar from "@/components/home/avatar.astro";
import OrbitingTech from "@/components/home/orbiting-tech.astro";
import TechList from "@/components/home/tech-list.astro";
import SectionHeader from "@/components/section-header.astro";
import { EXPERIENCE } from "@/data/experience";
import Experience from "@/components/home/experience.astro";
import Button from "@/components/ui/button.astro";
import Projects from "@/components/home/projects.astro";
import Pin from "@/components/icons/pin.astro";
import Github from "@/components/icons/github.astro";
import LinkedIn from "@/components/icons/linkedin.astro";
import Envelope from "@/components/icons/envelope.astro";
import ButtonLink from "@/components/ui/button-link.astro";
import GPTIcon from "@/components/icons/gpt.astro";
---

<Layout>
  <!-- background effects-->
  <div
    class="absolute inset-0 flex h-[500px] w-full items-center justify-center lg:fixed"
  >
    <Spotlight
      fill="var(--indigo-300)"
      className="absolute -z-10"
      client:idle
    />
  </div>

  <div
    class="container relative min-h-svh min-w-[400px] lg:grid lg:grid-cols-10 lg:gap-24"
  >
    <!-- hero -->
    <header
      class="relative w-full lg:sticky lg:top-0 lg:col-span-4 lg:flex lg:max-h-screen lg:flex-col lg:justify-between lg:py-24"
    >
      <div class="relative flex flex-grow flex-col items-start gap-8 text-left">
        <div class="flex flex-row gap-6">
          <!-- <Avatar /> -->
          <div class="flex-grow-1 flex-shrink-0">
            <a
              href="/"
              class="mb-2 block whitespace-nowrap bg-opacity-50 bg-gradient-to-b from-foreground to-zinc-300 bg-clip-text text-4xl font-bold tracking-normal text-transparent"
            >
              <h1>Tim Machnacki</h1>
            </a>
            <h2 class="mb-2 text-lg text-foreground text-zinc-300 lg:text-xl">
              Frontend Software Engineer
            </h2>
            <span class="flex items-center gap-2 text-sm text-muted-foreground">
              <Pin class={"size-4"} />
              Lake Orion, MI
            </span>
          </div>
        </div>
        <About client:load>
          <Avatar class="h-10 w-10 flex-shrink-0 rounded-full" />
        </About>
      </div>

      <nav
        class="absolute left-0 top-1/2 hidden flex-shrink-0 flex-grow text-zinc-500 lg:block"
        aria-label="In page jump links"
      >
        <ul class="w-max space-y-4">
          <li class="relative">
            <a
              id="skills-nav"
              href="#skills"
              class="group flex items-center gap-4 text-sm font-semibold uppercase tracking-widest transition-all hover:text-foreground [&.active]:text-foreground"
            >
              <span
                aria-hidden="true"
                class="h-px w-10 bg-zinc-500 transition-all duration-100 group-hover:w-16 group-hover:bg-foreground group-[&.active]:w-16 group-[&.active]:bg-foreground"
              ></span>
              <span>Skills</span>
            </a>
          </li>
          <li class="relative">
            <a
              id="experience-nav"
              href="#experience"
              class="group flex items-center gap-4 text-sm font-semibold uppercase tracking-widest transition-all hover:text-foreground [&.active]:text-foreground"
            >
              <span
                aria-hidden="true"
                class="h-px w-10 bg-zinc-500 transition-all duration-100 group-hover:w-16 group-hover:bg-foreground group-[&.active]:w-16 group-[&.active]:bg-foreground"
              ></span>
              <span>Experience</span>
            </a>
          </li>
          <li class="relative">
            <a
              id="projects-nav"
              href="#projects"
              class="group flex items-center gap-4 text-sm font-semibold uppercase tracking-widest transition-all hover:text-foreground [&.active]:text-foreground"
            >
              <span
                aria-hidden="true"
                class="h-px w-10 bg-zinc-500 transition-all duration-100 group-hover:w-16 group-hover:bg-foreground group-[&.active]:w-16 group-[&.active]:bg-foreground"
              ></span>
              <span>Projects</span>
            </a>
          </li>
        </ul>
      </nav>

      <ul class="flex flex-shrink-0 items-center gap-4">
        <li>
          <ButtonLink
            gradient={"full"}
            class={"rounded-full px-5"}
            href={"/resume.pdf"}
            target={"_blank"}
            aria-label={"Tim Machnacki's Resume (opens in a new tab)"}
          >
            Resume
          </ButtonLink>
        </li>
        <li>
          <a
            href="https://github.com/tmachnacki"
            target="_blank"
            aria-label="Tim Machnacki's Github (opens in a new tab)"
          >
            <Github
              class={"size-6 text-muted-foreground hover:text-foreground"}
            />
          </a>
        </li>
        <li>
          <a
            href="https://www.linkedin.com/in/timothy-machnacki-172b58257"
            target="_blank"
            aria-label="Tim Machnacki's LinkedIn (opens in a new tab)"
          >
            <LinkedIn
              class={"size-7 text-muted-foreground hover:text-foreground"}
            />
          </a>
        </li>
        <li>
          <a
            href="mailto:machnackit@gmail.com"
            target="_blank"
            aria-label="Email Tim Machnacki"
          >
            <Envelope
              class={"size-7 text-muted-foreground hover:text-foreground"}
            />
          </a>
        </li>
      </ul>
    </header>

    <!-- content -->
    <main class="relative w-full py-24 lg:col-span-6">
      <!-- about -->
      <section
        id="skills"
        class="mb-16 scroll-mt-16 md:mb-24 lg:mb-36 lg:scroll-mt-24 lg:px-4"
        aria-label="About Me"
        data-observable="true"
      >
        <SectionHeader title="Skills" />

        <OrbitingTech />
        <TechList />
      </section>

      <!-- experience -->
      <section
        id="experience"
        class="mb-16 scroll-mt-16 md:mb-24 lg:mb-36 lg:scroll-mt-24"
        aria-label="Work experience"
        data-observable="true"
      >
        <SectionHeader title="Experience" />
        <div>
          <ol class="group/list space-y-12">
            <!-- experience cards -->
            {
              EXPERIENCE.map((experience) => (
                <li>
                  <Experience {...experience} />
                </li>
              ))
            }
          </ol>
        </div>
      </section>

      <!-- Projects -->
      <section
        id="projects"
        class="mb-16 scroll-mt-16 md:mb-24 lg:mb-36 lg:scroll-mt-24"
        aria-label="Projects"
        data-observable="true"
      >
        <SectionHeader title="Projects" />
        <Projects />

        <div>
          <a href="/projects/archive/">view archive</a>
        </div>
      </section>
    </main>
  </div>

  <style scoped>
    .bg-grid {
      background-image: url("/grid.svg");
      background-position: top center;
      background-repeat: no-repeat;
      overflow-y: visible;
      overflow-x: clip;
    }
  </style>
</Layout>

<!-- scrollspy -->
<script is:inline>
  const threshold = 0.75;

  const changeNav = (entries, observer) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting && entry.intersectionRatio >= threshold) {
        document.querySelector(".active")?.classList.remove("active");
        const id = entry.target.getAttribute("id");
        const newLink = document
          .querySelector(`[href="#${id}"]`)
          .classList.add("active");
      }
    });
  };

  const options = {
    threshold: threshold,
  };

  const observer = new IntersectionObserver(changeNav, options);

  const sections = document.querySelectorAll("[data-observable='true']");
  sections.forEach((section) => {
    observer.observe(section);
  });
</script>
